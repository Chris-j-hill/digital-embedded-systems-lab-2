C51 COMPILER V9.54   SCREEN                                                                02/27/2018 17:49:52 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE SCREEN
OBJECT MODULE PLACED IN .\Objects\screen.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Source\screen.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\List
                    -ings\screen.lst) TABS(2) OBJECT(.\Objects\screen.obj)

line level    source

   1          #include "screen.h"
   2          
   3          #ifndef ADCUC841_H
   4          #define ADCUC841_H
   5          #include <ADUC841.H>
   6          #endif
   7          
   8          #include "config.h"
   9          
  10          //#include <math.h>
  11          
  12          extern uint8 mode;
  13          
  14          
  15          extern volatile uint16 dc_avg;    // <<<  use these value when displaying
  16          extern volatile uint16 rms_avg;
  17          extern volatile uint16 p2p_value;
  18          extern volatile uint32 avg_freq;
  19          
  20          
  21          const uint8 displaytable[]={  // 0     1     2     3     4     5     6     7     8     9
  22                                      0x6F, 0x28, 0x5D, 0x7C, 0x3a, 0x76, 0x77, 0x2c, 0x7f, 0x3e};
  23          
  24          void init_screen(){
  25   1          uint8 i;
  26   1          SPICON=0x33; //initilisation bits for screen
  27   1          Slave_select = 0;
  28   1      
  29   1        //reset screen display to zeros
  30   1          sendByteToSPI(1);
  31   1        for(i=0;i<5;i++)
  32   1          {
  33   2            sendByteToSPI(0);
  34   2          }
  35   1          
  36   1      }     
  37          
  38          void update_display(){
  39   1        uint32 displayVariable;
  40   1        uint32 clock=119526;
  41   1        
  42   1        uint8 indexDisplay=0;
  43   1        uint8 input_data=0;
  44   1        uint8 index;
  45   1        
  46   1        switch(mode){   //setup hardware based on new mode
  47   2          case 0:
  48   2          case 1:     break;
  49   2          case 2:     break;
  50   2          case 3:  // frequency
  51   2            
  52   2          //Compute the frequency
  53   2          displayVariable=CLOCK_SPEED/avg_freq; //Hz    
  54   2          
C51 COMPILER V9.54   SCREEN                                                                02/27/2018 17:49:52 PAGE 2   

  55   2          //displayVariable = clock/avg_freq; //Hz
  56   2          
  57   2          break;
  58   2        } 
  59   1          if (displayVariable>9999)
  60   1            displayVariable/=1000; //so freq is in kHz
  61   1      
  62   1          sendByteToSPI(1);
  63   1          for(index=0;index<4;index++) //startint with the least significant number
  64   1          { 
  65   2            sendByteToSPI(displaytable[displayVariable%10]);
  66   2            displayVariable=displayVariable/10;
  67   2          }
  68   1          sendByteToSPI(0);
  69   1      } 
  70          
  71          void sendByteToSPI(uint8 byte)
  72          {
*** WARNING C235 IN LINE 72 OF Source\screen.c: parameter 1: different types
  73   1        SPIDAT=byte;
  74   1        while(!ISPI);
  75   1        ISPI=0;
  76   1      }
  77          //}       //push values to display
  78          
  79          
  80          
  81          
  82           
  83          
  84          //sbit Slave_select = P3_6;  // initialize Slave Select bit to ENABL
  85          
  86          //SPICON=0x33;  //configure the SPICON
  87          
  88           
  89          
  90          //change the data to DEC, and use a table to find the HEX to display
  91          
  92          
  93          
  94          //transmit the data to SPIDAT in 4 bytes
  95          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    170    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
